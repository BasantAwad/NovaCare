{% extends "base.html" %}

{% block title %}Primary User - NovaBot{% endblock %}

{% block body %}
<div class="container-fluid p-4">
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h1>Good Morning, User</h1>
            <p class="lead">How can I help you today?</p>
        </div>
    </div>

    <!-- Main Connectivity/Status -->
    <div class="row mb-4 justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg bg-primary text-white border-0">
                <div class="card-body text-center p-5">
                    <i class="fas fa-robot fa-4x mb-3"></i>
                    <h2>I am Listening</h2>
                    <div class="mt-4">
                        <button class="btn btn-light btn-lg rounded-pill px-5 py-3 mx-2" onclick="simulateVoice()">
                            <i class="fas fa-microphone me-2"></i> Speak
                        </button>
                        <button class="btn btn-outline-light btn-lg rounded-pill px-5 py-3 mx-2"
                            onclick="document.getElementById('chat-toggle-btn').click()">
                            <i class="fas fa-keyboard me-2"></i> Type
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row g-4 justify-content-center">
        <div class="col-md-3">
            <div class="card h-100 shadow-sm text-center border-0 clickable-card"
                onclick="alert('Medication Reminder: Take 2 pills now.')">
                <div class="card-body p-4">
                    <i class="fas fa-pills fa-3x text-warning mb-3"></i>
                    <h4>Medication</h4>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card h-100 shadow-sm text-center border-0 clickable-card"
                onclick="alert('Calling Guardian...')">
                <div class="card-body p-4">
                    <i class="fas fa-phone-alt fa-3x text-success mb-3"></i>
                    <h4>Call Guardian</h4>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card h-100 shadow-sm text-center border-0 clickable-card bg-danger text-white"
                onclick="triggerEmergency()">
                <div class="card-body p-4">
                    <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                    <h4>EMERGENCY</h4>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card h-100 shadow-sm text-center border-0 clickable-card" onclick="alert('Streaming Music...')">
                <div class="card-body p-4">
                    <i class="fas fa-music fa-3x text-info mb-3"></i>
                    <h4>Music</h4>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Copy Chat Widget from dashboard.html (or include it) -->
{% include "dashboard_chat_widget.html" ignore missing %}

<!-- Voice Simulation Script -->
<script>
    function triggerEmergency() {
        if (confirm("Are you sure you want to trigger an EMERGENCY alert?")) {
            // In real app, post to API
            alert("Emergency Alert Sent to Guardian and Services!");
            reqChatWithText("HELP! EMERGENCY!");
        }
    }

    function reqChatWithText(text) {
        // Re-use logic from widget if available, or simple fetch
        fetch('/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: text })
        });
    }
</script>

<style>
    .clickable-card {
        cursor: pointer;
        transition: transform 0.2s;
    }

    .clickable-card:active {
        transform: scale(0.95);
    }
</style>
{% endblock %}